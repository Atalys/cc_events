
namespace = dpe_hw_duel


#monthly pulse

country_event = {
	id = dpe_hw_duel.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
#		always = no
		has_ai_personality = honorbound_warriors
		NOR = {
			has_country_flag = dpe_recent_HW_event
			has_country_flag = dpe_never_again_HW_event
		}
		any_country = {
			has_relation_flag = {
				flag = dpe_insult
				who = root
			}
			NOR = {
				has_country_flag = dpe_recent_HW_event
				has_relation_flag = {
					flag = dpe_has_had_HW_chain
					who = root
				}
			}
		}
	}
	
	immediate = {
		random_list = {
			1 = {
				random_country = {
					limit = {
						has_relation_flag = {
							flag = dpe_insult
							who = root
						}
						NOR = {
							has_country_flag = dpe_recent_HW_event
							has_relation_flag = {
								flag = dpe_has_had_HW_chain
								who = root
							}
						}
					}
					save_event_target_as = dpe_insult_country
					set_timed_relation_flag = {
						flag = dpe_has_had_HW_chain
						who = root
						days = 21600
					}
					set_timed_country_flag = {
						flag = dpe_recent_HW_event
						days = 9000
					}
				}
				
				set_timed_country_flag = {
					flag = dpe_recent_HW_event
					days = 7200
				}
				save_event_target_as = dpe_honourbound_country
				set_country_flag = dpe_has_had_HW_chain

				country_event = { id = dpe_hw_duel.2 days = 10 }
			}
			2 = {
				modifier = {
					factor = 0
					NOT = { has_country_flag = dpe_has_had_HW_chain }
				}
			}
		}
	}
}

country_event = {
	id = dpe_hw_duel.2
	title = dpe_hw_duel.2.name
	desc = dpe_hw_duel.2.desc

	picture = GFX_evt_victorious_army
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { exists = heir }

			heir = { save_event_target_as = dpe_duel_leader }
		}
		
		else_if = {
			limit = {
				any_owned_leader = {
					leader_of_faction = imperialist
					is_same_species = root
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
			}
			random_owned_leader = {
				limit = {
					leader_of_faction = imperialist
					is_same_species = root
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
				save_event_target_as = dpe_duel_leader
			}
		}
		else_if = {
			limit = {
				any_owned_leader = {
					is_same_species = root
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
			}
			random_owned_leader = {
				limit = {
					is_same_species = root
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
				save_event_target_as = dpe_duel_leader
			}
		}
		else = {
			random_owned_leader = {
				limit = {
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
				save_event_target_as = dpe_duel_leader
			}
		}
	}
	
	
	option = {
		name = dpe_hw_duel.2.A

		trigger = { exists = event_target:dpe_duel_leader }
		
		if = {
			limit = {
				exists = heir
				heir = { is_same_value = event_target:dpe_duel_leader }
			}
			custom_tooltip = dpe_hw_duel.2.A.tooltip.heir
		}
		else_if = {
			limit = {
				event_target:dpe_duel_leader = { leader_class = general }
			}
			custom_tooltip = dpe_hw_duel.2.A.tooltip.general
		}
		else_if = {
			limit = {
				event_target:dpe_duel_leader = { leader_class = admiral }
			}
			custom_tooltip = dpe_hw_duel.2.A.tooltip.admiral
		}
		else_if = {
			limit = {
				event_target:dpe_duel_leader = { leader_class = governor }
			}
			custom_tooltip = dpe_hw_duel.2.A.tooltip.governor
		}

		event_target:dpe_insult_country = {
			add_opinion_modifier = {
				who = root
				modifier = dpe_demanded_duel				
			}
		}
		
		hidden_effect = { event_target:dpe_insult_country = { country_event = { id = dpe_hw_duel.3 } } }
	}
	
	option = {
		name = dpe_hw_duel.2.B

		trigger = { exists = event_target:dpe_duel_leader }
		
		event_target:dpe_insult_country = {
			add_opinion_modifier = {
				who = root
				modifier = dpe_demanded_duel				
			}
		}
		
		hidden_effect = { event_target:dpe_insult_country = { country_event = { id = dpe_hw_duel.3 } } }
	}
	
	option = {
		name = dpe_hw_duel.2.C

		trigger = { NOT = { exists = event_target:dpe_duel_leader } }
		
		event_target:dpe_insult_country = {
			add_opinion_modifier = {
				who = root
				modifier = dpe_demanded_duel				
			}
		}
		
		hidden_effect = { event_target:dpe_insult_country = { country_event = { id = dpe_hw_duel.3 } } }
	}
	
	option = {
		name = dpe_hw_duel.2.D

		add_modifier = {
			modifier = dpe_cowardly_empire
			days = 3600
		}

		random_pop_faction = {
			limit = { is_pop_faction_type = imperialist }
			add_modifier = {
				modifier = dpe_cowardly_empire_faction
				days = 3600
			}
		}
		ai_chance = {
			factor = 0.5
			modifier = {
				factor = 2
				relative_power = {
					who = event_target:dpe_insult_country
					value < equivalent
				}
				relative_power = {
					who = event_target:dpe_insult_country
					value < inferior
				}
			}
			modifier = {
				factor = 2
				relative_power = {
					who = event_target:dpe_insult_country
					value < inferior
				}
			}
		}
	}
	
	option = {
		name = dpe_hw_duel.2.E
		custom_tooltip = dpe_hw_duel.2.E.tooltip

		add_modifier = {
			modifier = dpe_cowardly_empire
			days = 3600
		}

		random_pop_faction = {
			limit = { is_pop_faction_type = imperialist }
			add_modifier = {
				modifier = dpe_cowardly_empire_faction
				days = 3600
			}
		}

		hidden_effect = {
			set_country_flag = dpe_never_again_HW_event
		}
		ai_chance = {
			factor = 0.25
		}
	}
}


country_event = {
	id = dpe_hw_duel.3
	title = dpe_hw_duel.3.name
	desc = {
		trigger = {
			exists = event_target:dpe_duel_leader
			event_target:dpe_duel_leader = {
				is_same_value = from.heir
			}
		}
		text = dpe_hw_duel.3.desc.heir
	}
	desc = {
		trigger = {
			NAND = {
				exists = event_target:dpe_duel_leader
				event_target:dpe_duel_leader = {
					is_same_value = from.heir
				}
			}
		}
		text = dpe_hw_duel.3.desc.other
	}

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_hw_duel.3.reject

		from = {
			add_opinion_modifier = {
				modifier = dpe_honourless
				who = root
			}
			hidden_effect = { country_event = { id = dpe_hw_duel.4 days = 5 } }
		}

		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				has_ethic = ethic_fanatic_xenophobe
				has_valid_civic = civic_hive_devouring_swarm
				has_authority = auth_hive_mind
				has_authority = auth_machine_intelligence
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				relative_power = {
					who = from
					value < equivalent
				}
			}
			modifier = {
				factor = 1.5
				relative_power = {
					who = from
					value < inferior
				}
			}
			modifier = {
				factor = 0.75
				relative_power = {
					who = from
					value > equivalent
				}
			}
			modifier = {
				factor = 0.5
				relative_power = {
					who = from
					value > superior
				}
			}
			modifier = {
				factor = 0
				has_ai_personality = honorbound_warriors
			}
		}
	}

	option = {
		name = dpe_hw_duel.3.reject.FE

		from = {
			add_opinion_modifier = {
				modifier = dpe_honourless
				who = root
			}
			hidden_effect = { country_event = { id = dpe_hw_duel.4 days = 5 } }
		}

		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
			}
		}
	}
	
	option = {
		name = dpe_hw_duel.3.reject.purifier

		from = {
			add_opinion_modifier = {
				modifier = dpe_honourless
				who = root
			}
			hidden_effect = { country_event = { id = dpe_hw_duel.4 days = 5 } }
		}

		trigger = {
			has_ethic = ethic_fanatic_xenophobe
		}
	}

	option = {
		name = dpe_hw_duel.3.reject.swarm

		from = {
			add_opinion_modifier = {
				modifier = dpe_honourless
				who = root
			}
			hidden_effect = { country_event = { id = dpe_hw_duel.4 days = 5 } }
		}

		trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}

	option = {
		name = dpe_hw_duel.3.reject.hive

		from = {
			add_opinion_modifier = {
				modifier = dpe_honourless
				who = root
			}
			hidden_effect = { country_event = { id = dpe_hw_duel.4 days = 5 } }
		}

		trigger = {
			has_authority = auth_hive_mind
			NOT = { 
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
	}

	option = {
		name = dpe_hw_duel.3.reject.machine

		from = {
			add_opinion_modifier = {
				modifier = dpe_honourless
				who = root
			}
			hidden_effect = { country_event = { id = dpe_hw_duel.4 days = 5 } }
		}

		trigger = {
			has_authority = auth_machine_intelligence
		}
	}

	
	#positive responses
	option = {
		name = dpe_hw_duel.3.accept

		hidden_effect = {
			from = {
				country_event = { id = dpe_hw_duel.5 days = 5 }
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					has_ethic = ethic_pacifist
					has_ethic = ethic_fanatic_pacifist
				}
			}
		}

		trigger = {
			NOR = {
				AND = {
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_militarist
					any_owned_leader = {
						NOR = {
							leader_class = scientist
							is_same_value = root.leader
						}
					}
				}
				has_authority = auth_machine_intelligence
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_machine_terminator
			}
		}
	}
	
	option = {
		name = dpe_hw_duel.3.accept.machine

		hidden_effect = {
			from = {
				country_event = { id = dpe_hw_duel.5 days = 5 }
			}
		}

		trigger = {
			has_authority = auth_machine_intelligence
			NOT = { has_valid_civic = civic_machine_terminator }
		}
	}

	option = {
		name = dpe_hw_duel.3.accept.militarist

		hidden_effect = {
			country_event = { id = dpe_hw_duel.45 days = 3 }
		}

		ai_chance = {
			factor = 5
		}

		trigger = {
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
			any_owned_leader = {
				NOR = {
					leader_class = scientist
					is_same_value = root.leader
				}
			}
		}
	}
	
	option = {
		name = dpe_hw_duel.3.apologise

		add_modifier = {
			modifier = dpe_cowardly_empire
			days = 3600
		}

		if = {
			limit = {
				count_pop_factions = {
					count = 1
					limit = { is_pop_faction_type = imperialist }
				}
			}
			random_pop_faction = {
				limit = { is_pop_faction_type = imperialist }
				add_modifier = {
					modifier = dpe_cowardly_empire_faction
					days = 3600
				}
			}
		}

		hidden_effect = {
			from = { country_event = { id = dpe_hw_duel.48 } }
		}

		ai_chance = {
			factor = 2
			modifier = {
				factor = 0
				NOT = {
					relative_power = {
						who = from
						value < equivalent
					}
				}
			}
			modifier = {
				factor = 2
				NOT = {
					count_pop_factions = {
						count > 0
						limit = { is_pop_faction_type = imperialist }
					}
				}
			}
		}

		trigger = {
			NOR = {
				has_ai_personality = honorbound_warriors
				has_ethic = ethic_fanatic_militarist
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_machine_terminator
			}
		}
	}
}



country_event = {
	id = dpe_hw_duel.45
	title = dpe_hw_duel.45.name
	desc = dpe_hw_duel.45.desc

	picture = GFX_evt_victorious_army
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { exists = heir }

			heir = { save_event_target_as = dpe_duel_leader2 }
		}
		
		else_if = {
			limit = {
				any_owned_leader = {
					leader_of_faction = imperialist
					is_same_species = root
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
			}
			random_owned_leader = {
				limit = {
					leader_of_faction = imperialist
					is_same_species = root
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
				save_event_target_as = dpe_duel_leader2
			}
		}
		else_if = {
			limit = {
				any_owned_leader = {
					is_same_species = root
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
			}
			random_owned_leader = {
				limit = {
					is_same_species = root
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
				save_event_target_as = dpe_duel_leader2
			}
		}
		else = {
			random_owned_leader = {
				limit = {
					NOR = {
						leader_class = scientist
						is_same_value = root.leader
					}
				}
				save_event_target_as = dpe_duel_leader2
			}
		}
	}
	
	
	option = {
		name = dpe_hw_duel.45.A

		if = {
			limit = {
				exists = heir
				heir = { is_same_value = event_target:dpe_duel_leader2 }
			}
			custom_tooltip = dpe_hw_duel.45.A.tooltip.heir
		}
		else_if = {
			limit = {
				event_target:dpe_duel_leader2 = { leader_class = general }
			}
			custom_tooltip = dpe_hw_duel.45.A.tooltip.general
		}
		else_if = {
			limit = {
				event_target:dpe_duel_leader2 = { leader_class = admiral }
			}
			custom_tooltip = dpe_hw_duel.45.A.tooltip.admiral
		}
		else_if = {
			limit = {
				event_target:dpe_duel_leader2 = { leader_class = governor }
			}
			custom_tooltip = dpe_hw_duel.45.A.tooltip.governor
		}

		hidden_effect = { fromfrom = { country_event = { id = dpe_hw_duel.5 days = 2 } } }
	}
	
	option = {
		name = dpe_hw_duel.45.B

		hidden_effect = { fromfrom = { country_event = { id = dpe_hw_duel.5 days = 2 } } }
	}
}


#rejection
country_event = {
	id = dpe_hw_duel.4
	title = dpe_hw_duel.4.name
	desc = {
		trigger = {
			from = {
				NOR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
					has_ethic = ethic_fanatic_xenophobe
					has_valid_civic = civic_hive_devouring_swarm
					has_authority = auth_hive_mind
					has_authority = auth_machine_intelligence
				}
			}
		}
		text = dpe_hw_duel.4.desc
	}
	desc = {
		trigger = {
			from = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
		}
		text = dpe_hw_duel.4.desc.FE
	}
	desc = {
		trigger = {
			from = {
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		text = dpe_hw_duel.4.desc.phobe
	}
	desc = {
		trigger = {
			from = {
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
		text = dpe_hw_duel.4.desc.swarm
	}
	desc = {
		trigger = {
			from = {
				has_authority = auth_machine_intelligence
			}
		}
		text = dpe_hw_duel.4.desc.machine
	}
	desc = {
		trigger = {
			from = {
				has_authority = auth_hive_mind
				NOT = { has_valid_civic = civic_hive_devouring_swarm }
			}
		}
		text = dpe_hw_duel.4.desc.hive
	}
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}


	option = {
		name = dpe_hw_duel.4.option
	}
}



#apology
country_event = {
	id = dpe_hw_duel.48
	title = dpe_hw_duel.48.name
	desc = dpe_hw_duel.48.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_hw_duel.48.A

		add_opinion_modifier = {
			who =  from
			modifier = dpe_hw_forgiven
			
		}

		hidden_effect = {
			from = { country_event = { id = dpe_hw_duel.481 days = 5 } }
		}
	}
	option = {
		name = dpe_hw_duel.48.B

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					is_hostile_to = from
					is_rival = from
				}
			}
		}
		hidden_effect = {
			from = { country_event = { id = dpe_hw_duel.482 days = 5 } }
		}
	}
}


country_event = {
	id = dpe_hw_duel.481
	title = dpe_hw_duel.481.name
	desc = dpe_hw_duel.481.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = OK
	}
}

country_event = {
	id = dpe_hw_duel.482
	title = dpe_hw_duel.482.name
	desc = dpe_hw_duel.482.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = UNFORTUNATE
	}
}
	