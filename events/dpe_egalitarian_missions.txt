namespace = dpe_egalitarian_missions

country_event = {
	id = dpe_egalitarian_missions.1
	title = dpe_egalitarian_missions.1.name
	desc = dpe_egalitarian_missions.1.desc

	picture = GFX_evt_arguing_senate

	mean_time_to_happen = {
		years = 50
	}

	trigger = {
		is_country_type = default
		NOR = {
			has_country_flag = dpe_has_recent_egalitarian_mission
			has_country_flag = dpe_provided_with_egalitarian_mission
			has_ethic = ethic_gestalt_consciousness
			has_authority = auth_democratic
			has_ethic = ethic_egalitarian
			has_ethic = ethic_fanatic_egalitarian
			has_ethic = ethic_fanatic_authoritarian
		}
		has_faction = progressive

		any_relation = {
			is_country_type = default
			
			has_authority = auth_democratic
			has_faction = progressive
#			OR = {
#				has_ethic = ethic_egalitarian
#				has_ethic = ethic_fanatic_egalitarian
#			}
			OR = {
				is_in_federation_with = root
				has_defensive_pact = root
				has_non_aggression_pact = root
				is_overlord_to = root
			}
			NOR = {
				has_country_flag = dpe_has_recent_egalitarian_mission
				has_country_flag = dpe_has_provided_egalitarian_mission@root
				has_relation_flag = {
					flag = dpe_asked_for_egalitarian_mission
					who = root
				}
			}
		}
	}
	immediate = {
		set_timed_country_flag = {
			flag = dpe_has_recent_egalitarian_mission
			years = 60
		}
		random_relation = {
			limit = {
				is_country_type = default
				
				has_authority = auth_democratic
				has_faction = progressive
#				OR = {
#					has_ethic = ethic_egalitarian
#					has_ethic = ethic_fanatic_egalitarian
#				}
				OR = {
					is_in_federation_with = root
					has_defensive_pact = root
					has_non_aggression_pact = root
				}
				NOR = {
					has_country_flag = dpe_has_recent_egalitarian_mission
					has_country_flag = dpe_providing_egalitarian_mission
					has_relation_flag = {
						flag = dpe_asked_for_egalitarian_mission
						who = root
					}
				}
			}
			save_event_target_as = dpe_egalitarian
		}
	}
	option = {
		name = dpe_egalitarian_missions.1.A

		random_pop_faction = {
			limit = { is_pop_faction_type = progressive }
			add_modifier = {
				modifier = dpe_electoral_experiment_faction
				days = 3600
			}
		}

		random_pop_faction = {
			limit = { is_pop_faction_type = totalitarian }
			add_modifier = {
				modifier = dpe_electoral_experiment_faction_negative
				days = 3600
			}
		}

		event_target:dpe_egalitarian = {
			set_timed_country_flag = {
				flag = dpe_has_recent_egalitarian_mission
				years = 60
			}
			set_relation_flag = {
				flag = dpe_asked_for_egalitarian_mission
				who = root
			}
			hidden_effect = { country_event = { id = dpe_egalitarian_missions.2 } }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				count_pop_factions = {
					limit = {
						is_pop_faction_type = progressive
						support > 0.05
					}
					count = 0
				}
			}
			modifier = {
				factor = 2
				count_pop_factions = {
					limit = {
						is_pop_faction_type = progressive
						support > 0.15
					}
					count = 1
				}
			}
		}
	}
	option = {
		name = dpe_egalitarian_missions.1.B

		random_pop_faction = {
			limit = { is_pop_faction_type = progressive }
			add_modifier = {
				modifier = dpe_denied_elections
				days = 3600
			}
		}

		custom_tooltip = dpe_egalitarian_missions.1.B.tooltip #Every other pop faction but the totalitarian faction receive the modifier §R$dpe_denied_a_say$§!, giving:\n\n§R-20% $MOD_FACTION_HAPPINESS$§!
		hidden_effect = {
			every_pop_faction = {
				limit = {
					NOR = {
						is_pop_faction_type = totalitarian
						is_pop_faction_type = progressive
					}
				}
				add_modifier = {
					modifier = dpe_denied_a_say
					days = 3600
				}
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				count_pop_factions = {
					limit = {
						is_pop_faction_type = progressive
						support > 0.1
					}
					count = 0
				}
			}
			modifier = {
				factor = 2
				count_pop_factions = {
					limit = {
						is_pop_faction_type = progressive
						support > 0.05
					}
					count = 0
				}
			}
			modifier = {
				factor = 0.5
				count_pop_factions = {
					limit = {
						is_pop_faction_type = progressive
						support > 0.15
					}
					count = 1
				}
			}
		}
	}
}


country_event = {
	id = dpe_egalitarian_missions.2
	title = dpe_egalitarian_missions.2.name
	desc = dpe_egalitarian_missions.2.desc

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	is_triggered_only = yes

	option = {
		name = dpe_egalitarian_missions.2.option

		hidden_effect = { country_event = { id = dpe_egalitarian_missions.3 } }
	}
}


country_event = {
	id = dpe_egalitarian_missions.3
	title = dpe_egalitarian_missions.3.name
	desc = dpe_egalitarian_missions.3.desc

	diplomatic = yes

	picture_event_data = {
		portrait = fromfrom
		planet_background = fromfrom
		graphical_culture = fromfrom
		city_level = fromfrom
		room = fromfrom.ruler
	}

	is_triggered_only = yes

	option = {
		name = dpe_egalitarian_missions.3.option

		hidden_effect = { country_event = { id = dpe_egalitarian_missions.4 } }
	}
}

country_event = {
	id = dpe_egalitarian_missions.4
	title = dpe_egalitarian_missions.4.name
	desc = dpe_egalitarian_missions.4.desc

	diplomatic = yes

	picture_event_data = {
		portrait = fromfromfrom
		planet_background = fromfromfrom
		graphical_culture = fromfromfrom
		city_level = fromfromfrom
		room = fromfromfrom.ruler
	}

	is_triggered_only = yes

	option = {
		name = dpe_egalitarian_missions.4.A
		custom_tooltip = dpe_egalitarian_missions.4.help.tooltip

		fromfromfrom = {
			add_opinion_modifier = {
				modifier = dpe_helping_with_elections
				who = root
			}
			hidden_effect = {
				set_country_flag = dpe_provided_with_egalitarian_mission
				country_event = { id = dpe_egalitarian_missions.6 days = 5 }
			}
		}
		hidden_effect = {
			set_country_flag = dpe_has_provided_egalitarian_mission@fromfromfrom
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.5
				OR = {
					has_non_aggression_pact = fromfromfrom
					is_overlord_to = fromfromfrom
				}
			}
			modifier = {
				factor = 1.5
				is_friendly_to = fromfromfrom
			}
			modifier = {
				factor = 2
				fromfromfrom = {
					relative_power = {
						who = root
						value > equivalent
					}
				}
			}
		}
	}

	option = {
		name = dpe_egalitarian_missions.4.B

		fromfromfrom = {
			add_opinion_modifier = {
				modifier = dpe_rejected_help_with_elections
				who = root
			}
			hidden_effect = { country_event = { id = dpe_egalitarian_missions.5 days = 5 } }
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_ethic = ethic_fanatic_egalitarian
			}
			modifier = {
				factor = 0.5
				fromfromfrom = {
					relative_power = {
						who = root
						value > equivalent
					}
				}
			}
		}
	}
	
	option = {
		name = dpe_egalitarian_missions.4.C
		custom_tooltip = dpe_egalitarian_missions.4.help.tooltip

		fromfromfrom = {
			add_opinion_modifier = {
				modifier = dpe_offered_some_help_with_elections
				who = root
			}
			hidden_effect = { country_event = { id = dpe_egalitarian_missions.7 days = 5 } }
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				OR = {
					has_non_aggression_pact = fromfromfrom
					is_overlord_to = fromfromfrom
				}
			}
			modifier = {
				factor = 2
				fromfromfrom = {
					relative_power = {
						who = root
						value < equivalent
					}
				}
			}
			modifier = {
				factor = 2
				has_monthly_income = {
					resource = minerals
					value < 50
				}
				minerals < 2500
			}
		}
	}
}

#negative response
country_event = {
	id = dpe_egalitarian_missions.5
	title = dpe_egalitarian_missions.5.name
	desc = dpe_egalitarian_missions.5.desc

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	is_triggered_only = yes

	option = { name = UNFORTUNATE }
}


#positive response
country_event = {
	id = dpe_egalitarian_missions.6
	title = dpe_egalitarian_missions.6.name
	desc = dpe_egalitarian_missions.6.desc

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	is_triggered_only = yes

	option = {
		name = EXCELLENT

		add_modifier = {
			modifier = dpe_electoral_experiment
			days = 3600
		}

		hidden_effect = { from = { country_event = { id = dpe_egalitarian_missions.8 days = 90 } } }
	}
}

#bribe response
country_event = {
	id = dpe_egalitarian_missions.7
	title = dpe_egalitarian_missions.7.name
	desc = dpe_egalitarian_missions.7.desc

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	is_triggered_only = yes

	option = {
		name = dpe_egalitarian_missions.7.A

		add_modifier = {
			modifier = dpe_paying_foreign_country
			days = 240
		}

		add_modifier = {
			modifier = dpe_electoral_experiment
			days = 360
		}

		hidden_effect = { from = { country_event = { id = dpe_egalitarian_missions.8 days = 90 } } }

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.5
				any_country = {
					OR = {
						is_hostile_to = root
						is_rival = root
						is_domineering_to = root
					}
					relative_power = {
						who = root
						value = overwhelming
					}
				}
			}
			modifier = {
				factor = 0.5
				has_monthly_income = {
					resource = minerals
					value < 50
				}
				minerals < 2500
			}
			modifier = {
				factor = 2
				has_monthly_income = {
					resource = minerals
					value > 150
				}
			}
		}
	}
	
	option = {
		name = dpe_egalitarian_missions.7.B

		hidden_effect = { from = { country_event = { id = dpe_egalitarian_missions.71 } } }

		ai_chance = {
			factor = 1
		}
	}
}

#negative response
country_event = {
	id = dpe_egalitarian_missions.71
	title = dpe_egalitarian_missions.71.name
	desc = dpe_egalitarian_missions.71.desc

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	is_triggered_only = yes

	option = {
		name = UNFORTUNATE

		from = {
			add_opinion_modifier = {
				who = root
				modifier = dpe_rejected_help_with_elections
			}
			hidden_effect = {
				remove_opinion_modifier = {
					who = root
					modifier = dpe_offered_some_help_with_elections
				}
			}
		}
	}
}


#positive response
country_event = {
	id = dpe_egalitarian_missions.72
	title = dpe_egalitarian_missions.72.name
	desc = dpe_egalitarian_missions.72.desc

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	is_triggered_only = yes

	option = {
		name = EXCELLENT

		add_minerals = 1000
		
		hidden_effect = {
			set_country_flag = dpe_has_provided_egalitarian_mission@from
		}
	}
}

#cheat them or not
country_event = {
	id = dpe_egalitarian_missions.8
	title = dpe_egalitarian_missions.8.name
	desc = dpe_egalitarian_missions.8.desc
	picture = GFX_evt_galactic_senate

	is_triggered_only = yes

	trigger = {
		exists = from
	}

	option = {
		name = dpe_egalitarian_missions.8.A
		custom_tooltip = dpe_egalitarian_missions.8.A.tooltip

		hidden_effect = {
			from = {
				random_list = {
					2 = { #truly authoritarian result
						country_event = { id = dpe_egalitarian_missions.9 days = 30 }
						
						modifier = {
							factor = 2
							count_pop_factions = {
								limit = {
									is_pop_faction_type = totalitarian
									support > 0.6
								}
								count = 1
							}
						}
						modifier = {
							factor = 2
							count_pop_factions = {
								limit = {
									is_pop_faction_type = totalitarian
									support > 0.4
								}
								count = 1
							}
						}
						modifier = {
							factor = 0.5
							count_pop_factions = {
								limit = {
									is_pop_faction_type = totalitarian
									support < 0.25
								}
								count = 1
							}
						}
					}
					2 = { #authoritarian result contested
						country_event = { id = dpe_egalitarian_missions.10 days = 30 }
					}
				}
			}
		}

		ai_chance = {
			factor = 2
			modifier = {
				factor = 0.5
				count_pop_factions = {
					limit = {
						is_pop_faction_type = progressive
						pop_percentage = {
							limit = {
								happiness < 0.5
							}
							percentage > 0.75
						}
					}
					count = 1
				}
			}
			modifier = {
				factor = 0.5
				count_pop_factions = {
					limit = {
						is_pop_faction_type = progressive
						support > 0.5
					}
					count = 1
				}
			}
			modifier = {
				factor = 0.8
				has_ethic = ethic_egalitarian
			}
			modifier = {
				factor = 0.5
				has_ethic = ethic_fanatic_egalitarian
			}
			modifier = {
				factor = 2
				from = {
					relative_power = {
						who = root
						value > equivalent
					}
				}
			}
			modifier = {
				factor = 0.5
				from = {
					relative_power = {
						who = root
						value < equivalent
					}
				}
			}
			modifier = {
				factor = 2
				from = {
					has_defensive_pact = root
				}
			}
		}
	}
	option = {
		name = dpe_egalitarian_missions.8.B
		custom_tooltip = dpe_egalitarian_missions.8.B.tooltip

		hidden_effect = {
			from = {
				random_list = {
					1 = { #truly authoritarian result
						country_event = { id = dpe_egalitarian_missions.11 days = 30 }

						modifier = {
							factor = 2
							count_pop_factions = {
								limit = {
									is_pop_faction_type = totalitarian
									support > 0.6
								}
								count = 1
							}
						}
						modifier = {
							factor = 2
							count_pop_factions = {
								limit = {
									is_pop_faction_type = totalitarian
									support > 0.4
								}
								count = 1
							}
						}
						modifier = {
							factor = 0.5
							count_pop_factions = {
								limit = {
									is_pop_faction_type = totalitarian
									support < 0.25
								}
								count = 1
							}
						}
					}
					1 = { #result contra auth wishes
						country_event = { id = dpe_egalitarian_missions.12 days = 30 }
					}
				}
			}
		}

		ai_chance = {
			factor = 1
		}
	}
}


#They complied, good result
country_event = {
	id = dpe_egalitarian_missions.9
	title = dpe_egalitarian_missions.9.name
	desc = dpe_egalitarian_missions.9.desc
	picture = GFX_evt_arguing_senate
	
	is_triggered_only = yes

	trigger = {
		exists = from
	}

	option = {
		name = dpe_egalitarian_missions.9.option

		add_modifier = {
			modifier = dpe_auth_held_successful_election
			days = 1800
		}
		hidden_effect = {
			from = {
				country_event = { id = dpe_egalitarian_missions.91 }
			}
		}
	}
}

country_event = {
	id = dpe_egalitarian_missions.91
	title = dpe_egalitarian_missions.91.name
	desc = dpe_egalitarian_missions.91.desc
	picture = GFX_evt_arguing_senate
	
	is_triggered_only = yes

	option = {
		name = dpe_egalitarian_missions.91.option

		from = {
			add_opinion_modifier = {
				modifier = dpe_electoral_help_auth
				who = root
			}
			hidden_effect = {
				remove_opinion_modifier = {
					modifier = dpe_rejected_help_with_elections
					who = root
				}
				remove_opinion_modifier = {
					modifier = dpe_helping_with_elections
					who = root
				}

				country_event = { id = dpe_egalitarian_missions.20 days = 3600 }
			}
		}
	}
}


#They complied, there is some dissent
country_event = {
	id = dpe_egalitarian_missions.10
	title = dpe_egalitarian_missions.10.name
	desc = dpe_egalitarian_missions.10.desc
	picture = GFX_evt_arguing_senate
	
	is_triggered_only = yes

	trigger = {
		exists = from
	}

	option = {
		name = dpe_egalitarian_missions.10.option

		add_modifier = {
			modifier = dpe_auth_held_election
			days = 1800
		}
		hidden_effect = {
			from = {
				country_event = { id = dpe_egalitarian_missions.101 }
			}
		}
	}
}

country_event = {
	id = dpe_egalitarian_missions.101
	title = dpe_egalitarian_missions.101.name
	desc = dpe_egalitarian_missions.101.desc
	picture = GFX_evt_arguing_senate
	
	is_triggered_only = yes

	option = {
		name = dpe_egalitarian_missions.101.option

		random_pop_faction = {
			limit = {
				is_pop_faction_type = progressive
			}
			add_modifier = {
				modifier = dpe_betrayed_democracy_faction
				days = 3600
			}
		}
		from = {
			add_opinion_modifier = {
				modifier = dpe_electoral_help_auth
				who = root
			}
			hidden_effect = {
				remove_opinion_modifier = {
					modifier = dpe_rejected_help_with_elections
					who = root
				}
				remove_opinion_modifier = {
					modifier = dpe_helping_with_elections
					who = root
				}

				country_event = { id = dpe_egalitarian_missions.20 days = 3600 }
			}
		}
		every_relation = {
			limit = {
				has_authority = auth_democratic
				OR = {
					has_ethic = ethic_egalitarian
					has_ethic = ethic_fanatic_egalitarian
				}
			}
			add_opinion_modifier = {
				who = root
				modifier = dpe_betrayed_democracy_opinion
			}
		}
	}
}