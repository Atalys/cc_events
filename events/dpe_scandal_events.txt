namespace = dpe_scandal

#triggered in performance events
country_event = {
	id = dpe_scandal.1
	title = dpe_scandal.1.name
	desc = dpe_scandal.1.desc
	
	picture = GFX_news_room
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = default
		OR = {
			AND = {
				has_ethic = ethic_fanatic_materialist
				NOT = { has_ethic = ethic_egalitarian }
			}
			AND = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_authoritarian
			}
		}
		NOR = {
			has_country_flag = dpe_satisfied_egalitarians
			has_country_flag = dpe_recent_charity_scandal
		}
		exists = ruler
		ruler = { NOT = { leader_of_faction = totalitarian } }
	}
	
	immediate = {
		set_timed_country_flag = {
			flag = dpe_recent_charity_scandal
			years = 50
		}
	}
	
	option = {
		name = dpe_scandal.1.A
		
		add_modifier = {
			modifier = dpe_charity_unpopular_ruler
			days = 3600
		}
		
		random_pop_faction = {
			limit = { is_pop_faction_type = technologist }
			add_modifier = {
				modifier = dpe_charity_faction_undeserving
				days = 3600
			}
		}
		
		ai_chance = {
			factor = 1.5
			modifier = {
				factor = 0.25
				count_pop_factions = {
					limit = {
						is_pop_faction_type = technologist
						support > 0.3
					}
				}
			}
		}
	}
		
	option = {
		name = dpe_scandal.1.B
		shift_ethic = ethic_egalitarian
		
		random_pop_faction = {
			limit = { is_pop_faction_type = technologist }
			add_modifier = {
				modifier = dpe_charity_faction_undeserving
				days = 3600
			}
		}
		
		
		random_pop_faction = {
			limit = { is_pop_faction_type = progressive }
			add_modifier = { modifier = embraced_faction days = 3600 }
			hidden_effect = { 
				add_modifier = { modifier = embraced_faction_timer days = 3600 }
				owner = {
					every_pop_faction = {
						limit = {
							NOR = {
								is_same_value = prevprev
								is_pop_faction_type = technologist
							}
						}
						add_modifier = { modifier = embraced_another_faction days = 3600 }
					}
				}
			}
		}
		
		ai_chance = {
			modifier = {
				factor = 0
				has_ethic = ethic_fanatic_authoritarian
			}
			modifier = {
				factor = 0.5
				has_ethic = ethic_authoritarian
			}
			modifier = {
				factor = 2
				count_pop_factions = {
					limit = {
						is_pop_faction_type = progressive
						support > 0.15
					}
				}
			}
		}
		
		trigger = { has_faction = progressive }
	}

	option = {
		name = dpe_scandal.1.C
		custom_tooltip = dpe_scandal.1.C.tooltip
		hidden_effect = {
			kill_leader = { type = ruler show_notification = no }
		}
		
		ai_chance = {
			factor = 2
			modifier = {
				factor = 5
				count_pop_factions = {
					limit = {
						is_pop_faction_type = technologist
						support > 0.3
					}
				}
			}
		}
	}
}




#remove modifiers if ruler changes
country_event = {
	id = dpe_scandal.99
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { has_modifier = dpe_charity_unpopular_ruler }
			remove_modifier = dpe_charity_unpopular_ruler
		}
		
		if = {
			limit = {
				count_pop_factions = {
					limit = {
						is_pop_faction_type = technologist
						has_modifier = dpe_charity_faction_undeserving
					}
					count = 1
				}
			}
			random_pop_faction = {
				limit = { is_pop_faction_type = technologist }
				remove_modifier = dpe_charity_faction_undeserving
			}
		}
		
		if = {
			limit = { has_modifier = cc_ruler_humiliated }
			remove_modifier = cc_ruler_humiliated
		}
		
		if = {
			limit = {
				count_pop_factions = {
					limit = {
						is_pop_faction_type = xenoist
						has_modifier = cc_xenophobic_offence_1
					}
					count = 1
				}
			}
			random_pop_faction = {
				limit = { is_pop_faction_type = xenoist }
				remove_modifier = cc_xenophobic_offence_1
			}
		}
		
		if = {
			limit = {
				count_pop_factions = {
					limit = {
						is_pop_faction_type = xenoist
						has_modifier = cc_xenophobic_offence_2
					}
					count = 1
				}
			}
			random_pop_faction = {
				limit = { is_pop_faction_type = xenoist }
				remove_modifier = cc_xenophobic_offence_2
			}
		}
	}
}